import{u as E,i as O,a as b,r as l,h as g,b as j,j as e,x as V}from"./index-D2GD3Ky5.js";import{c as v,a as i,F as f,b as w,d as r,E as d}from"./index.esm-Dm7ACXP-.js";const T=()=>{const m=E(),p=O(),{auth_token:x,current_user:M}=b(s=>s.auth),{items:h,total:y}=b(s=>s.cart),{currency:c}=b(s=>s.preferences),[o,N]=l.useState("shipping"),[t,S]=l.useState(null),[C,_]=l.useState(null),[u,$]=l.useState(null),[n,F]=l.useState({items:h,subtotal:y,shipping:0,tax:0,total:y});l.useEffect(()=>{x||p("/login")},[x,p]),l.useEffect(()=>{t&&q()},[t]);const q=async()=>{try{const s=await g.post("/api/calculate-tax-shipping",{items:h,shippingAddress:t},{headers:{Authorization:`Bearer ${x}`}});F(a=>({...a,shipping:s.data.shipping,tax:s.data.tax,total:a.subtotal+s.data.shipping+s.data.tax}))}catch(s){console.error("Error calculating tax and shipping:",s),m(j({id:Date.now().toString(),type:"error",message:"Failed to calculate tax and shipping. Please try again."}))}},k=s=>{S(s),N("payment")},L=s=>{$(s),N("review")},A=async()=>{try{const s=await g.post("/api/orders",{items:h,shippingAddress:t,billingAddress:C||t,paymentMethod:u,orderTotal:n.total},{headers:{Authorization:`Bearer ${x}`}});m(V()),m(j({id:Date.now().toString(),type:"success",message:"Order placed successfully!"})),p(`/order-confirmation/${s.data.order_uid}`)}catch(s){console.error("Error placing order:",s),m(j({id:Date.now().toString(),type:"error",message:"Failed to place order. Please try again."}))}},D=v().shape({addressLine1:i().required("Address is required"),city:i().required("City is required"),state:i().required("State is required"),postalCode:i().required("Postal code is required"),country:i().required("Country is required")}),P=v().shape({cardNumber:i().required("Card number is required").matches(/^\d{16}$/,"Invalid card number"),expiryDate:i().required("Expiry date is required").matches(/^(0[1-9]|1[0-2])\/\d{2}$/,"Invalid expiry date (MM/YY)"),cvv:i().required("CVV is required").matches(/^\d{3,4}$/,"Invalid CVV")});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),e.jsx("div",{className:"flex justify-between mb-8",children:["shipping","payment","review"].map((s,a)=>e.jsxs("div",{className:`flex items-center ${a<["shipping","payment","review"].indexOf(o)?"text-green-500":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${a<=["shipping","payment","review"].indexOf(o)?"bg-green-500":"bg-gray-300"} flex items-center justify-center text-white`,children:a+1}),e.jsx("span",{className:"ml-2 capitalize",children:s}),a<2&&e.jsx("div",{className:"w-full h-1 bg-gray-300 mx-2"})]},s))}),o==="shipping"&&e.jsx(f,{initialValues:t||{addressLine1:"",addressLine2:"",city:"",state:"",postalCode:"",country:""},validationSchema:D,onSubmit:k,children:({errors:s,touched:a})=>e.jsxs(w,{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"addressLine1",className:"block mb-2",children:"Address Line 1"}),e.jsx(r,{name:"addressLine1",type:"text",className:`w-full p-2 border rounded ${s.addressLine1&&a.addressLine1?"border-red-500":""}`}),e.jsx(d,{name:"addressLine1",component:"div",className:"text-red-500 mt-1"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"addressLine2",className:"block mb-2",children:"Address Line 2 (Optional)"}),e.jsx(r,{name:"addressLine2",type:"text",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block mb-2",children:"City"}),e.jsx(r,{name:"city",type:"text",className:`w-full p-2 border rounded ${s.city&&a.city?"border-red-500":""}`}),e.jsx(d,{name:"city",component:"div",className:"text-red-500 mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block mb-2",children:"State"}),e.jsx(r,{name:"state",type:"text",className:`w-full p-2 border rounded ${s.state&&a.state?"border-red-500":""}`}),e.jsx(d,{name:"state",component:"div",className:"text-red-500 mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postalCode",className:"block mb-2",children:"Postal Code"}),e.jsx(r,{name:"postalCode",type:"text",className:`w-full p-2 border rounded ${s.postalCode&&a.postalCode?"border-red-500":""}`}),e.jsx(d,{name:"postalCode",component:"div",className:"text-red-500 mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block mb-2",children:"Country"}),e.jsx(r,{name:"country",type:"text",className:`w-full p-2 border rounded ${s.country&&a.country?"border-red-500":""}`}),e.jsx(d,{name:"country",component:"div",className:"text-red-500 mt-1"})]})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Continue to Payment"})]})}),o==="payment"&&e.jsx(f,{initialValues:u||{cardNumber:"",expiryDate:"",cvv:""},validationSchema:P,onSubmit:L,children:({errors:s,touched:a})=>e.jsxs(w,{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Payment Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"cardNumber",className:"block mb-2",children:"Card Number"}),e.jsx(r,{name:"cardNumber",type:"text",className:`w-full p-2 border rounded ${s.cardNumber&&a.cardNumber?"border-red-500":""}`}),e.jsx(d,{name:"cardNumber",component:"div",className:"text-red-500 mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiryDate",className:"block mb-2",children:"Expiry Date (MM/YY)"}),e.jsx(r,{name:"expiryDate",type:"text",className:`w-full p-2 border rounded ${s.expiryDate&&a.expiryDate?"border-red-500":""}`}),e.jsx(d,{name:"expiryDate",component:"div",className:"text-red-500 mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cvv",className:"block mb-2",children:"CVV"}),e.jsx(r,{name:"cvv",type:"text",className:`w-full p-2 border rounded ${s.cvv&&a.cvv?"border-red-500":""}`}),e.jsx(d,{name:"cvv",component:"div",className:"text-red-500 mt-1"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx(r,{type:"checkbox",name:"sameAsBilling",className:"mr-2"}),"Billing address same as shipping"]})}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Review Order"})]})}),o==="review"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Order Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Shipping Address"}),e.jsx("p",{children:t.addressLine1}),t.addressLine2&&e.jsx("p",{children:t.addressLine2}),e.jsx("p",{children:`${t.city}, ${t.state} ${t.postalCode}`}),e.jsx("p",{children:t.country})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Payment Method"}),e.jsxs("p",{children:["Card ending in ",u.cardNumber.slice(-4)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Order Summary"}),n.items.map(s=>e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{children:[c," ",(s.price*s.quantity).toFixed(2)]})]},s.product_uid)),e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[c," ",n.subtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:[c," ",n.shipping.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:[c," ",n.tax.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold mt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[c," ",n.total.toFixed(2)]})]})]})]}),e.jsx("button",{onClick:A,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Place Order"})]})]})};export{T as default};
