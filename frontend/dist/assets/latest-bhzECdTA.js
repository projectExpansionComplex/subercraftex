import{q as A,v as B,u as D,a as I,r as a,j as e,L,h as P,b,w as T}from"./index-DKe-Z_P2.js";import{l as W}from"./lodash-PQkaxq7T.js";const q=(d,i,g,c)=>{const[x,o]=a.useState([]),[v,m]=a.useState(!1),[j,r]=a.useState(null),[l,u]=a.useState({currentPage:1,totalPages:1,totalProducts:0,productsPerPage:20});return a.useEffect(()=>{(async()=>{m(!0),r(null);try{const t=await P.get("http://localhost:1337/api/products",{params:{category_uid:d,page:c,limit:l.productsPerPage,sort:g,...i}});o(t.data.products),u({currentPage:t.data.page,totalPages:Math.ceil(t.data.total_count/l.productsPerPage),totalProducts:t.data.total_count,productsPerPage:l.productsPerPage})}catch{r("Failed to fetch products. Please try again.")}finally{m(!1)}})()},[d,i,g,c,l.productsPerPage]),{products:x,loading:v,error:j,pagination:l}},O=()=>{const{category_uid:d}=A(),[i,g]=B(),c=D(),{auth_token:x}=I(s=>s.auth),[o,v]=a.useState({price_min:i.get("filter_price_min")||"",price_max:i.get("filter_price_max")||"",designer:i.get("filter_designer")||"",country:i.get("filter_country")||"",material:i.get("filter_material")||""}),[m,j]=a.useState(i.get("sort")||"popularity"),[r,l]=a.useState(Number(i.get("page"))||1),[u,p]=a.useState(3),[t,k]=a.useState(null),{products:z,loading:C,error:w,pagination:_}=q(d||"",o,m,r),[y,F]=a.useState({uid:"",name:"",description:"",productCount:0});a.useEffect(()=>{d&&(async()=>{try{const n=await P.get(`http://localhost:1337/api/categories/${d}`);F(n.data)}catch(n){console.error("Failed to fetch category info:",n)}})()},[d]);const S=a.useCallback(()=>{const s={page:r,sort:m};Object.entries(o).forEach(([n,f])=>{f&&(s[`filter_${n}`]=f)}),g(s)},[o,r,m,g]);a.useEffect(()=>{S()},[S]);const H=(s,n)=>{v(f=>({...f,[s]:n})),l(1)},h=a.useMemo(()=>W.debounce(H,300),[]),$=s=>{j(s.target.value),l(1)},N=s=>{l(s)},V=s=>{k(s)},M=async s=>{if(!x){c(b({id:Date.now().toString(),type:"error",message:"Please log in to add items to your wishlist."}));return}try{await P.post("http://localhost:1337/api/wishlist",{product_uid:s},{headers:{Authorization:`Bearer ${x}`}}),c(b({id:Date.now().toString(),type:"success",message:"Product added to wishlist!"}))}catch{c(b({id:Date.now().toString(),type:"error",message:"Failed to add product to wishlist. Please try again."}))}},E=s=>{c(T({product_uid:s.uid,quantity:1,price:s.price})),c(b({id:Date.now().toString(),type:"success",message:"Product added to cart!"}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("nav",{className:"text-sm breadcrumbs mb-4",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(L,{to:"/",children:"Home"})}),e.jsx("li",{children:e.jsx(L,{to:"/shop",children:"Shop"})}),e.jsx("li",{children:y.name})]})}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:y.name}),e.jsx("p",{className:"text-gray-600 mb-8",children:y.description}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Price Range"}),e.jsxs("div",{className:"mt-1 flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"Min",value:o.price_min,onChange:s=>h("price_min",s.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),e.jsx("input",{type:"number",placeholder:"Max",value:o.price_max,onChange:s=>h("price_max",s.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designer"}),e.jsx("input",{type:"text",value:o.designer,onChange:s=>h("designer",s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Country"}),e.jsx("input",{type:"text",value:o.country,onChange:s=>h("country",s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Material"}),e.jsx("input",{type:"text",value:o.material,onChange:s=>h("material",s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]})]})]}),e.jsxs("div",{className:"w-full md:w-3/4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{htmlFor:"sort",className:"text-sm font-medium text-gray-700",children:"Sort by:"}),e.jsxs("select",{id:"sort",value:m,onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"popularity",children:"Popularity"}),e.jsx("option",{value:"price_asc",children:"Price: Low to High"}),e.jsx("option",{value:"price_desc",children:"Price: High to Low"}),e.jsx("option",{value:"newest",children:"Newest Arrivals"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>p(2),className:`p-2 ${u===2?"bg-gray-200":"bg-white"} rounded`,"aria-label":"Two column view",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM3 16a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"})})}),e.jsx("button",{onClick:()=>p(3),className:`p-2 ${u===3?"bg-gray-200":"bg-white"} rounded`,"aria-label":"Three column view",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM3 16a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"})})}),e.jsx("button",{onClick:()=>p(4),className:`p-2 ${u===4?"bg-gray-200":"bg-white"} rounded`,"aria-label":"Four column view",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM3 16a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"})})})]})]}),C&&e.jsx("div",{className:"text-center py-8",children:"Loading..."}),w&&e.jsx("div",{className:"text-center py-8 text-red-600",children:w}),!C&&!w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-${u} gap-6`,children:z.map(s=>e.jsxs("div",{className:"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300",children:[e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.designerName}),e.jsxs("p",{className:"text-lg font-bold mb-2",children:["$",s.price.toFixed(2)]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>V(s),className:"text-indigo-600 hover:text-indigo-800",children:"Quick View"}),e.jsx("button",{onClick:()=>M(s.uid),className:"text-gray-600 hover:text-red-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]})]})]},s.uid))}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>N(r-1),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:_.totalPages},(s,n)=>n+1).map(s=>e.jsx("button",{onClick:()=>N(s),className:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${s===r?"text-indigo-600 bg-indigo-50":"text-gray-700 hover:bg-gray-50"}`,children:s},s)),e.jsx("button",{onClick:()=>N(r+1),disabled:r===_.totalPages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:t.name}),e.jsx("button",{onClick:()=>k(null),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("img",{src:t.thumbnail,alt:t.name,className:"w-full h-64 object-cover mb-4 rounded"}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.designerName}),e.jsxs("p",{className:"text-xl font-bold mb-4",children:["$",t.price.toFixed(2)]}),e.jsx("p",{className:"text-gray-700 mb-4",children:t.description}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>E(t),className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",children:"Add to Cart"}),e.jsx("button",{onClick:()=>M(t.uid),className:"border border-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-100",children:"Add to Wishlist"})]})]})})]})};export{O as default};
