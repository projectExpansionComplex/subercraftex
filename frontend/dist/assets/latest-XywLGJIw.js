import{q as D,u as S,a as M,r as i,j as e,L as O,h as d,w as I,b as c}from"./index-D2GD3Ky5.js";import{f as x}from"./format-SmSpYad1.js";const B=()=>{const{order_uid:r}=D(),n=S(),{auth_token:a}=M(s=>s.auth),[l,y]=i.useState("summary"),[t,h]=i.useState(null),[o,j]=i.useState(null),[f,N]=i.useState([]),[v,u]=i.useState(!0),[g,b]=i.useState(null);i.useEffect(()=>{const s=async()=>{u(!0),b(null);try{const[p,$,k]=await Promise.all([d.get(`http://localhost:1337/api/orders/${r}`,{headers:{Authorization:`Bearer ${a}`}}),d.get(`http://localhost:1337/api/orders/${r}/tracking`,{headers:{Authorization:`Bearer ${a}`}}),d.get("http://localhost:1337/api/users/orders",{headers:{Authorization:`Bearer ${a}`}})]);h(p.data),j($.data),N(k.data)}catch(p){b("Failed to load order information. Please try again later."),console.error("Error fetching order data:",p)}u(!1)};s();const m=setInterval(s,3e5);return()=>clearInterval(m)},[r,a]);const w=async()=>{try{await d.post(`http://localhost:1337/api/orders/${r}/returns`,{},{headers:{Authorization:`Bearer ${a}`}}),n(c({id:Date.now().toString(),type:"success",message:"Return initiated successfully"}));const s=await d.get(`http://localhost:1337/api/orders/${r}`,{headers:{Authorization:`Bearer ${a}`}});h(s.data)}catch{n(c({id:Date.now().toString(),type:"error",message:"Failed to initiate return"}))}},A=async()=>{try{await d.post(`http://localhost:1337/api/orders/${r}/cancel`,{},{headers:{Authorization:`Bearer ${a}`}}),n(c({id:Date.now().toString(),type:"success",message:"Order cancelled successfully"}));const s=await d.get(`http://localhost:1337/api/orders/${r}`,{headers:{Authorization:`Bearer ${a}`}});h(s.data)}catch{n(c({id:Date.now().toString(),type:"error",message:"Failed to cancel order"}))}},_=()=>{t.items.forEach(s=>{n(I({product_uid:s.product_uid,quantity:s.quantity,price:s.price_at_time}))}),n(c({id:Date.now().toString(),type:"success",message:"Items added to cart"}))};return v?e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading order details..."}):g?e.jsx("div",{className:"text-red-500 text-center p-4",children:g}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Order Tracking"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-4",children:["Order #",t.orderNumber]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("span",{className:"text-gray-600",children:["Status: ",e.jsx("span",{className:"font-semibold",children:t.status})]}),e.jsxs("span",{className:"text-gray-600",children:["Order Date: ",x(new Date(t.orderDate),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{onClick:_,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",children:"Reorder"}),t.status==="pending"&&e.jsx("button",{onClick:A,className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded",children:"Cancel Order"}),["shipped","delivered"].includes(t.status)&&e.jsx("button",{onClick:w,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded",children:"Initiate Return"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:["summary","items","shipping","billing"].map(s=>e.jsx("button",{onClick:()=>y(s),className:`${l===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm capitalize`,children:s},s))})}),l==="summary"&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-semibold mb-2",children:["Total Amount: $",t.totalAmount.toFixed(2)]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[t.items.length," item(s)"]}),o&&e.jsxs("div",{className:"bg-gray-100 p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tracking Information"}),e.jsxs("p",{children:["Carrier: ",o.carrier]}),e.jsxs("p",{children:["Tracking Number: ",o.trackingNumber]}),e.jsxs("p",{children:["Status: ",o.status]}),e.jsxs("p",{children:["Estimated Delivery: ",x(new Date(o.estimatedDelivery),"MMM dd, yyyy")]})]})]}),l==="items"&&e.jsx("div",{children:t.items.map((s,m)=>e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 py-4 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:`https://picsum.photos/seed/${s.product_uid}/100/100`,alt:s.name,className:"w-16 h-16 object-cover rounded mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-gray-600",children:["Quantity: ",s.quantity]})]})]}),e.jsxs("p",{className:"font-semibold",children:["$",(s.price_at_time*s.quantity).toFixed(2)]})]},m))}),l==="shipping"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Shipping Address"}),e.jsx("p",{children:t.shippingAddress.address_line1}),t.shippingAddress.address_line2&&e.jsx("p",{children:t.shippingAddress.address_line2}),e.jsxs("p",{children:[t.shippingAddress.city,", ",t.shippingAddress.state," ",t.shippingAddress.postal_code]}),e.jsx("p",{children:t.shippingAddress.country})]}),l==="billing"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Billing Address"}),e.jsx("p",{children:t.billingAddress.address_line1}),t.billingAddress.address_line2&&e.jsx("p",{children:t.billingAddress.address_line2}),e.jsxs("p",{children:[t.billingAddress.city,", ",t.billingAddress.state," ",t.billingAddress.postal_code]}),e.jsx("p",{children:t.billingAddress.country}),e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:"Payment Method"}),e.jsx("p",{children:t.paymentMethod.type}),e.jsxs("p",{children:["**** **** **** ",t.paymentMethod.last4]})]})]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order History"}),f.map(s=>e.jsxs(O,{to:`/order-tracking/${s.uid}`,className:`block border-b border-gray-200 py-3 last:border-b-0 ${s.uid===r?"bg-blue-50":"hover:bg-gray-50"}`,children:[e.jsxs("p",{className:"font-semibold",children:["Order #",s.orderNumber]}),e.jsx("p",{className:"text-sm text-gray-600",children:x(new Date(s.orderDate),"MMM dd, yyyy")}),e.jsxs("p",{className:"text-sm font-medium",children:["$",s.totalAmount.toFixed(2)," - ",s.status]})]},s.uid))]})})]})]})};export{B as default};
