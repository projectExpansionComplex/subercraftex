import{d as L,i as R,u as V,a as U,r as l,h as M,b,j as e}from"./index-CN4mytNG.js";import{l as X}from"./lodash-DmVdQZWs.js";import{I as c}from"./input-H6EeTG7A.js";import{T as G,P as H,a as K,b as Q}from"./textarea-CAXdhgRJ.js";import{B as x}from"./button-DOrCrM0T.js";import{L as o}from"./label-Pv-_ZLJP.js";import{S as W,a as Y,b as Z,c as ee,d as te}from"./select-Dkjzrebo.js";import{C as se}from"./checkbox-Dg5kI09b.js";import{B as f}from"./badge-BwdBWPgq.js";import{C as ae}from"./calendar-W8AtwoKH.js";import{C as ie}from"./calendar-D0HLL2Fn.js";import{X as P}from"./x-38l38irq.js";import{f as re}from"./format-SmSpYad1.js";import"./utils-BzlngoKp.js";import"./clsx-B-dksMZM.js";import"./index-B24b04u7.js";import"./index-D-rZVh68.js";import"./index-C4XYmX5R.js";import"./index-iJe1fZmX.js";import"./index-DkxuCrZr.js";import"./tslib.es6-BzQWXb8g.js";import"./index-Bn065rCZ.js";import"./index-Bnyao0vq.js";import"./chevron-down-Wtnf-15n.js";import"./chevron-right-CpU1fC0r.js";import"./chevron-left-C2fE0cwO.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],de=L("Plus",le),qe=()=>{var w;const h=R(),g=V(),{current_user:ne,auth_token:p}=U(t=>t.auth),[s,d]=l.useState({title:"",description:"",category:"",budgetType:"fixed",budgetFixed:0,budgetMin:0,budgetMax:0,deadline:"",skills:[],attachments:[]}),[y,F]=l.useState([]),[i,D]=l.useState({}),[N,v]=l.useState(!1),[j,T]=l.useState(!1),[u,S]=l.useState("");l.useEffect(()=>{if(!p){h("/login");return}E(),$()},[p,h]);const E=async()=>{try{const t=await M.get("http://localhost:1337/api/project-categories",{headers:{Authorization:`Bearer ${p}`}});F(t.data)}catch(t){console.error("Failed to fetch categories:",t),g(b({id:Date.now().toString(),type:"error",message:"Failed to load project categories. Please try again."}))}},$=()=>{const t=localStorage.getItem("projectDraft");t&&d(JSON.parse(t))},n=t=>{const{name:a,value:r}=t.target;d(m=>({...m,[a]:r})),z({...s,[a]:r})},I=()=>{d(t=>({...t,budgetType:t.budgetType==="fixed"?"range":"fixed"}))},q=t=>{S(t.target.value)},B=()=>{u&&!s.skills.includes(u)&&(d(t=>({...t,skills:[...t.skills,u]})),S(""))},A=t=>{d(a=>({...a,skills:a.skills.filter(r=>r!==t)}))},_=t=>{if(t.target.files){const a=Array.from(t.target.files);d(r=>({...r,attachments:[...r.attachments,...a]}))}},O=t=>{d(a=>({...a,attachments:a.attachments.filter((r,m)=>m!==t)}))},C=()=>{const t={};return s.title.trim()||(t.title="Title is required"),s.description.trim()||(t.description="Description is required"),s.category||(t.category="Category is required"),s.budgetType==="fixed"&&s.budgetFixed<=0&&(t.budget="Please enter a valid budget"),s.budgetType==="range"&&(s.budgetMin<=0&&(t.budgetMin="Minimum budget is required"),s.budgetMax<=0&&(t.budgetMax="Maximum budget is required"),s.budgetMax<=s.budgetMin&&(t.budgetMax="Maximum budget must be greater than minimum budget")),s.deadline||(t.deadline="Deadline is required"),s.skills.length===0&&(t.skills="At least one skill is required"),D(t),Object.keys(t).length===0},z=l.useCallback(X.debounce(t=>{localStorage.setItem("projectDraft",JSON.stringify(t))},1e3),[]),J=async()=>{if(!C())return;v(!0);const t=new FormData;Object.entries(s).forEach(([a,r])=>{a==="attachments"?r.forEach(m=>{t.append("attachments",m)}):a==="skills"?t.append(a,JSON.stringify(r)):t.append(a,r.toString())});try{const a=await M.post("http://localhost:1337/api/projects",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${p}`}});g(b({id:Date.now().toString(),type:"success",message:"Project posted successfully!"})),localStorage.removeItem("projectDraft"),h(`/project/${a.data.uid}`)}catch(a){console.error("Failed to post project:",a),g(b({id:Date.now().toString(),type:"error",message:"Failed to post project. Please try again."}))}finally{v(!1)}},k=()=>{!j&&!C()||T(!j)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center text-purple-800",children:"Post a New Project"}),j?e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-8 mb-8",children:[e.jsx("h2",{className:"text-3xl font-semibold mb-4 text-purple-700",children:s.title}),e.jsx("p",{className:"mb-6 text-gray-700",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-600",children:"Category"}),e.jsx("p",{children:(w=y.find(t=>t.uid===s.category))==null?void 0:w.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-600",children:"Budget"}),e.jsx("p",{children:s.budgetType==="fixed"?`$${s.budgetFixed}`:`$${s.budgetMin} - $${s.budgetMax}`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-600",children:"Deadline"}),e.jsx("p",{children:s.deadline})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-600",children:"Required Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.skills.map((t,a)=>e.jsx(f,{variant:"secondary",children:t},a))})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-600",children:"Attachments"}),e.jsx("ul",{className:"list-disc list-inside",children:s.attachments.map((t,a)=>e.jsx("li",{children:t.name},a))})]}),e.jsx(x,{onClick:k,className:"mt-8",children:"Edit Project"})]}):e.jsx("form",{className:"bg-white shadow-lg rounded-lg p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Project Title"}),e.jsx(c,{id:"title",name:"title",value:s.title,onChange:n,placeholder:"Enter project title",className:i.title?"border-red-500":""}),i.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.title})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Project Description"}),e.jsx(G,{id:"description",name:"description",value:s.description,onChange:n,placeholder:"Describe your project",rows:4,className:i.description?"border-red-500":""}),i.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.description})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"category",children:"Category"}),e.jsxs(W,{value:s.category,onValueChange:t=>n({target:{name:"category",value:t}}),children:[e.jsx(Y,{className:i.category?"border-red-500":"",children:e.jsx(Z,{placeholder:"Select a category"})}),e.jsx(ee,{children:y.map(t=>e.jsx(te,{value:t.uid,children:t.name},t.uid))})]}),i.category&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.category})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Budget"}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(se,{id:"fixed-budget",checked:s.budgetType==="fixed",onCheckedChange:I}),e.jsx("label",{htmlFor:"fixed-budget",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Fixed Price"})]}),s.budgetType==="fixed"?e.jsx(c,{type:"number",name:"budgetFixed",value:s.budgetFixed,onChange:n,placeholder:"Enter fixed budget",className:i.budget?"border-red-500":""}):e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{type:"number",name:"budgetMin",value:s.budgetMin,onChange:n,placeholder:"Min budget",className:i.budgetMin?"border-red-500":""}),e.jsx(c,{type:"number",name:"budgetMax",value:s.budgetMax,onChange:n,placeholder:"Max budget",className:i.budgetMax?"border-red-500":""})]}),i.budget&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.budget}),i.budgetMin&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.budgetMin}),i.budgetMax&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.budgetMax})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"deadline",children:"Project Deadline"}),e.jsxs(H,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.deadline&&"text-muted-foreground"}`,children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),s.deadline?re(new Date(s.deadline),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Q,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:s.deadline?new Date(s.deadline):void 0,onSelect:t=>n({target:{name:"deadline",value:t?t.toISOString().split("T")[0]:""}}),initialFocus:!0})})]}),i.deadline&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.deadline})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Required Skills"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(c,{type:"text",value:u,onChange:q,placeholder:"Enter a skill"}),e.jsx(x,{type:"button",onClick:B,size:"icon",children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.skills.map((t,a)=>e.jsxs(f,{variant:"secondary",className:"flex items-center gap-1",children:[t,e.jsx("button",{type:"button",onClick:()=>A(t),className:"text-xs text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx(P,{className:"h-3 w-3"})})]},a))}),i.skills&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.skills})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Attachments"}),e.jsx(c,{type:"file",multiple:!0,onChange:_,className:"mb-2"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.attachments.map((t,a)=>e.jsxs(f,{variant:"secondary",className:"flex items-center gap-1",children:[t.name,e.jsx("button",{type:"button",onClick:()=>O(a),className:"text-xs text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx(P,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx(x,{type:"button",onClick:k,variant:"outline",children:"Preview"}),e.jsx(x,{type:"button",onClick:J,disabled:N,children:N?"Posting...":"Post Project"})]})]})})]})})};export{qe as default};
